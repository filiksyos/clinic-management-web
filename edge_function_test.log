[2025-04-15T15:41:14.468Z] ===== EDGE FUNCTION TEST STARTED =====
[2025-04-15T15:41:14.490Z] Testing edge function at: https://szcvvdedhulcrgpanudt.supabase.co/functions/v1/appointment-notifications
[2025-04-15T15:41:14.494Z] Test data: {
  "record": {
    "id": "test-id-1744731674438",
    "patient_id": "some-patient-id",
    "appointment_date": "2025-04-15T15:41:14.439Z"
  }
}
[2025-04-15T15:41:14.796Z] Request sent. Waiting for response...
[2025-04-15T15:41:16.710Z] Response received in 2213ms
[2025-04-15T15:41:16.727Z] Status Code: 500
[2025-04-15T15:41:16.743Z] Response Headers:
[2025-04-15T15:41:16.745Z]   date: Tue, 15 Apr 2025 15:41:16 GMT
[2025-04-15T15:41:16.811Z]   content-type: application/json
[2025-04-15T15:41:16.949Z]   transfer-encoding: chunked
[2025-04-15T15:41:17.079Z]   connection: keep-alive
[2025-04-15T15:41:17.235Z]   cf-ray: 930c8bca6e1bb684-MRS
[2025-04-15T15:41:17.310Z]   cf-cache-status: DYNAMIC
[2025-04-15T15:41:17.398Z]   strict-transport-security: max-age=31536000; includeSubDomains; preload
[2025-04-15T15:41:17.547Z]   vary: Accept-Encoding
[2025-04-15T15:41:17.629Z]   sb-project-ref: szcvvdedhulcrgpanudt
[2025-04-15T15:41:17.709Z]   x-deno-execution-id: 03dcc1be-ab0d-462c-9d89-fef36b4af4a7
[2025-04-15T15:41:17.832Z]   x-sb-edge-region: eu-west-3
[2025-04-15T15:41:17.929Z]   x-served-by: supabase-edge-runtime
[2025-04-15T15:41:17.957Z]   server: cloudflare
[2025-04-15T15:41:17.971Z]   alt-svc: h3=":443"; ma=86400
[2025-04-15T15:41:17.986Z] Server error: Check the edge function logs in Supabase dashboard
[2025-04-15T15:41:17.996Z] Response Body:
[2025-04-15T15:41:17.997Z] {
  "error": "unknown/unsupported ASN.1 DER tag: 0x2d",
  "stack": "DOMExceptionDataError: unknown/unsupported ASN.1 DER tag: 0x2d\n    at importKeyRSA (ext:deno_crypto/00_crypto.js:3398:58)\n    at SubtleCrypto.importKey (ext:deno_crypto/00_crypto.js:1005:16)\n    at getAccessToken (file:///tmp/user_fn_szcvvdedhulcrgpanudt_c4f39ec0-bb1b-446f-a34a-12facd0dc584_3/index.ts:52:43)\n    at Server.<anonymous> (file:///tmp/user_fn_szcvvdedhulcrgpanudt_c4f39ec0-bb1b-446f-a34a-12facd0dc584_3/index.ts:180:31)\n    at eventLoopTick (ext:core/01_core.js:168:7)\n    at async #respond (https://deno.land/std@0.168.0/http/server.ts:221:18)"
}
[2025-04-15T15:41:17.999Z] ===== EDGE FUNCTION TEST COMPLETED =====
[2025-04-15T15:45:04.923Z] ===== EDGE FUNCTION TEST STARTED =====
[2025-04-15T15:45:04.944Z] Testing edge function at: https://szcvvdedhulcrgpanudt.supabase.co/functions/v1/appointment-notifications
[2025-04-15T15:45:04.967Z] Test data: {
  "record": {
    "id": "test-id-1744731904919",
    "patient_id": "some-patient-id",
    "appointment_date": "2025-04-15T15:45:04.919Z"
  }
}
[2025-04-15T15:45:05.790Z] Request sent. Waiting for response...
[2025-04-15T15:45:07.251Z] Response received in 2282ms
[2025-04-15T15:45:07.252Z] Status Code: 500
[2025-04-15T15:45:07.253Z] Response Headers:
[2025-04-15T15:45:07.260Z]   date: Tue, 15 Apr 2025 15:45:07 GMT
[2025-04-15T15:45:07.261Z]   content-type: application/json
[2025-04-15T15:45:07.264Z]   transfer-encoding: chunked
[2025-04-15T15:45:07.269Z]   connection: keep-alive
[2025-04-15T15:45:07.271Z]   cf-ray: 930c91719837e242-MRS
[2025-04-15T15:45:07.272Z]   cf-cache-status: DYNAMIC
[2025-04-15T15:45:07.273Z]   strict-transport-security: max-age=31536000; includeSubDomains; preload
[2025-04-15T15:45:07.275Z]   vary: Accept-Encoding
[2025-04-15T15:45:07.276Z]   sb-project-ref: szcvvdedhulcrgpanudt
[2025-04-15T15:45:07.277Z]   x-deno-execution-id: dc351270-70ac-47e0-a6d8-f5bb904e7308
[2025-04-15T15:45:07.279Z]   x-sb-edge-region: eu-west-3
[2025-04-15T15:45:07.295Z]   x-served-by: supabase-edge-runtime
[2025-04-15T15:45:07.297Z]   server: cloudflare
[2025-04-15T15:45:07.298Z]   alt-svc: h3=":443"; ma=86400
[2025-04-15T15:45:07.299Z] Server error: Check the edge function logs in Supabase dashboard
[2025-04-15T15:45:07.306Z] Response Body:
[2025-04-15T15:45:07.309Z] {
  "error": "unknown/unsupported ASN.1 DER tag: 0x2d",
  "stack": "DOMExceptionDataError: unknown/unsupported ASN.1 DER tag: 0x2d\n    at importKeyRSA (ext:deno_crypto/00_crypto.js:3398:58)\n    at SubtleCrypto.importKey (ext:deno_crypto/00_crypto.js:1005:16)\n    at getAccessToken (file:///tmp/user_fn_szcvvdedhulcrgpanudt_c4f39ec0-bb1b-446f-a34a-12facd0dc584_3/index.ts:52:43)\n    at Server.<anonymous> (file:///tmp/user_fn_szcvvdedhulcrgpanudt_c4f39ec0-bb1b-446f-a34a-12facd0dc584_3/index.ts:180:31)\n    at eventLoopTick (ext:core/01_core.js:168:7)\n    at async #respond (https://deno.land/std@0.168.0/http/server.ts:221:18)"
}
[2025-04-15T15:45:07.313Z] ===== EDGE FUNCTION TEST COMPLETED =====
[2025-04-15T15:46:15.800Z] ===== EDGE FUNCTION TEST STARTED =====
[2025-04-15T15:46:15.807Z] Testing edge function at: https://szcvvdedhulcrgpanudt.supabase.co/functions/v1/appointment-notifications
[2025-04-15T15:46:15.808Z] Test data: {
  "record": {
    "id": "test-id-1744731975797",
    "patient_id": "some-patient-id",
    "appointment_date": "2025-04-15T15:46:15.797Z"
  }
}
[2025-04-15T15:46:15.966Z] Request sent. Waiting for response...
[2025-04-15T15:46:18.040Z] Response received in 2231ms
[2025-04-15T15:46:18.065Z] Status Code: 200
[2025-04-15T15:46:18.091Z] Response Headers:
[2025-04-15T15:46:18.095Z]   date: Tue, 15 Apr 2025 15:46:17 GMT
[2025-04-15T15:46:18.098Z]   content-type: application/json
[2025-04-15T15:46:18.121Z]   transfer-encoding: chunked
[2025-04-15T15:46:18.131Z]   connection: keep-alive
[2025-04-15T15:46:18.143Z]   cf-ray: 930c93242a18defa-MRS
[2025-04-15T15:46:18.146Z]   cf-cache-status: DYNAMIC
[2025-04-15T15:46:18.153Z]   strict-transport-security: max-age=31536000; includeSubDomains; preload
[2025-04-15T15:46:18.155Z]   vary: Accept-Encoding
[2025-04-15T15:46:18.156Z]   sb-project-ref: szcvvdedhulcrgpanudt
[2025-04-15T15:46:18.158Z]   x-deno-execution-id: 3fcb6b8b-9e4b-4057-bf98-a4a8fa0b6b5e
[2025-04-15T15:46:18.159Z]   x-sb-edge-region: eu-west-3
[2025-04-15T15:46:18.161Z]   x-served-by: supabase-edge-runtime
[2025-04-15T15:46:18.170Z]   server: cloudflare
[2025-04-15T15:46:18.173Z]   alt-svc: h3=":443"; ma=86400
[2025-04-15T15:46:18.186Z] Response Body:
[2025-04-15T15:46:18.197Z] {
  "success": true,
  "message": "Notification sent successfully",
  "result": {
    "name": "projects/clinic-management-90817/messages/103921419836979821"
  }
}
[2025-04-15T15:46:18.207Z] SUCCESS: The edge function processed the request successfully!
[2025-04-15T15:46:18.213Z] FCM Notification sent successfully. Message ID: projects/clinic-management-90817/messages/103921419836979821
[2025-04-15T15:46:18.216Z] ===== EDGE FUNCTION TEST COMPLETED =====
